# Upsun configuration for Directus (validated & simplified)

applications:
  directus:
    type: nodejs:20
    source:
      root: .

    dependencies:
      nodejs:
        pnpm: "*"

    build:
      flavor: none

    hooks:
      build: |
        set -e
        pnpm install --frozen-lockfile

    web:
      commands:
        start: npx directus start
      locations:
        /:
          passthru: true

    relationships:
      database: "postgresql:postgresql"

    mounts:
      /directus/uploads:
        source: local
        source_path: uploads

    variables:
      env:
        NODE_ENV: production
        DIRECTUS_HOST: 0.0.0.0
        DIRECTUS_PORT: 8080
        DIRECTUS_PUBLIC_URL: "https://{default}/"
        KEY: "7070255f406be6751d5c78a2f1a7984984a3dbf9e4f4442ea7d6d143d940b040"
        SECRET: "6116487b-cda1-52c2-b5b5-c8022c45e263"
        ADMIN_EMAIL: admin@example.com
        ADMIN_PASSWORD: d1r3ctu5

services:
  postgresql:
    type: postgresql:15

routes:
  https://{default}/:
    type: upstream
    upstream: directus:http
